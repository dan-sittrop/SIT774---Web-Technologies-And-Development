<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thought Collective</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Import Cormorant Garamond font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&display=swap"
        rel="stylesheet">

    <style>
        /* Apply the font to the entire page */
        body,
        p,
        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        a,
        div,
        span {
            font-family: 'Cormorant Garamond', serif;
        }

        /* Placeholder banner styling */
        .placeholder-banner {
            height: 66vh;
            /* Gray background color */
            border: 3px solid #7f7d7d;
            /* Adding a border */
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            position: relative;
        }

        /* Ensures that the footer sticks to the bottom */
        body {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main {
            flex: 1;
        }

        .scrolling-banner {
            animation: scrollBanner 20s linear reverse;
            animation-iteration-count: infinite;
        }

        @keyframes scrollBanner {
            0% {
                transform: translateX(60%);
            }

            100% {
                transform: translateX(-10%);
            }
        }

        .rounded-image {
            border-radius: 15px;
            /* You can change the radius value as needed */
        }

        .custom-offcanvas {
            width: 50% !important;
            /* Adjust the percentage as needed */
            max-width: none !important;
        }

        /* Ensures the navbar stays on top when scrolling */
        .sticky-top {
            z-index: 1030;
            /* Ensure it stays above other content */
        }
    </style>
</head>

<body>
    <!-- Header Section -->
    <header>
        <!-- Navigation Bar -->
        <nav style="background-color: #EAE0C8;">
            <div class="container-fluid">
                <div class="row header-top d-flex align-items-center">
                    <div class="col-md-9">
                        <div class="scrolling-banner" id="banner">Data Leadership Event - 24th of October 2024 -
                            "Adopting new technology whilst building foundations" <strong>Register Now!!</strong>
                        </div>
                    </div>
                    <div class="col-md-2 m-2 d-flex align-items-center justify-content-end">
                        <a href="/login" class="btn btn-outline-secondary">Login</a>
                    </div>
                </div>
            </div>

            <!-- Offcanvas -->
            <div class="offcanvas offcanvas-start custom-offcanvas" tabindex="-1" id="offcanvasExample"
                aria-labelledby="offcanvasExampleLabel">
                <div class="offcanvas-header">
                    <h3 class="offcanvas-title" id="offcanvasExampleLabel"><strong>Your Activity</strong></h3>
                    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <!-- Table for Membership Data -->
                    <h5>Memberships</h5>
                    <table class="table" id="membershipTable">
                        <thead>
                            <tr>
                                <th class="col-1">ID</th>
                                <th class="col-2">Username</th>
                                <th class="col-2">Category</th>
                                <th class="col-2">Date</th>
                                <th class="col-4">Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Membership data will be dynamically populated here -->
                        </tbody>
                    </table>

                    <!-- Table for Events Data -->
                    <h5>Registered Events</h5>
                    <table class="table" id="eventsTable">
                        <thead>
                            <tr>
                                <th class="col-1">ID</th>
                                <th class="col-2">Username</th>
                                <th class="col-2">Category</th>
                                <th class="col-2">Date</th>
                                <th class="col-4">Description</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Events data will be dynamically populated here -->
                        </tbody>
                    </table>

                    <!-- Table for Publications Data -->
                    <h5>Saved Articles</h5>
                    <table class="table" id="publicationsTable">
                        <thead>
                            <tr>
                                <th class="col-1">ID</th>
                                <th class="col-2">Username</th>
                                <th class="col-2">Category</th>
                                <th class="col-2">Date</th>
                                <th class="col-3">Description</th>
                                <th class="col-2">Misc</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Publications data will be dynamically populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Main Navigation Bar -->
            <div class="container-flex">
                <nav class="navbar navbar-expand-lg sticky-top" style="background-color: #add8e6; height: 80px;">
                    <div class="container-fluid">
                        <!-- Logo -->
                        <div class="position-absolute start-5">
                            <img src="FullLogo_Transparent2.png" alt="Bootstrap" width="80%" height="80%">
                        </div>
                        <!-- Navbar Links -->
                        <div class="collapse navbar-collapse justify-content-center" id="navbarNavDropdown">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link" href="/home" id="homelink">Home</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#introduction" id="membershipDropdown"
                                        data-bs-toggle="dropdown" aria-expanded="false">Membership</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="/membership">Membership Registration</a>
                                        </li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#introduction" id="eventsDropdown"
                                        data-bs-toggle="dropdown" aria-expanded="false">Events</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="/events">All Events</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#introduction" id="publicationsDropdown"
                                        data-bs-toggle="dropdown" aria-expanded="false">Publications</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="/blog">Articles</a></li>
                                    </ul>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="#introduction" id="contactDropdown"
                                        data-bs-toggle="dropdown" aria-expanded="false">Contact</a>
                                    <ul class="dropdown-menu">
                                        <li><a class="dropdown-item" href="/contact">Contact Us</a></li>
                                    </ul>
                                </li>
                            </ul>
                        </div>
                        <!-- Display Username -->
                        <% if (username) { %>
                            <h5><strong>Welcome
                                    <span>
                                        <%= username %>
                                    </span>!</strong></h5>
                            <button class="btn btn-outline-secondary ms-3" id="offcanvasTrigger" type="button"
                                data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample"
                                aria-controls="offcanvasExample">
                                <span class="navbar-toggler-icon"></span>
                            </button>

                            <% } else { %>
                                <p class="mb-0">No user logged in</p>
                                <% } %>
                    </div>
                </nav>
            </div>
        </nav>
    </header>
</body>

<script>
    document.getElementById('offcanvasTrigger').addEventListener('click', function (e) {
        // Fetch membership data
        fetch('/user-metadata?category=membership')
            .then(response => response.json())
            .then(data => {
                // Populate the membership table with data
                const membershipTableBody = document.querySelector('#membershipTable tbody');
                membershipTableBody.innerHTML = ''; // Clear any existing content

                if (data.length > 0) {
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.id}</td>
                            <td>${item.username}</td>
                            <td>${item.category}</td>
                            <td>${item.date}</td>
                            <td>${item.description}</td>
                        `;
                        membershipTableBody.appendChild(row);
                    });
                } else {
                    // If no data, show a message
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="6">No data available.</td>`;
                    membershipTableBody.appendChild(row);
                }
            })
            .catch(error => console.error('Error fetching membership data:', error));

        // Fetch events data
        fetch('/user-metadata?category=events')
            .then(response => response.json())
            .then(data => {
                // Populate the events table with data
                const eventsTableBody = document.querySelector('#eventsTable tbody');
                eventsTableBody.innerHTML = ''; // Clear any existing content

                if (data.length > 0) {
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.id}</td>
                            <td>${item.username}</td>
                            <td>${item.category}</td>
                            <td>${item.date}</td>
                            <td>${item.description}</td>
                        `;
                        eventsTableBody.appendChild(row);
                    });
                } else {
                    // If no data, show a message
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="6">No data available.</td>`;
                    eventsTableBody.appendChild(row);
                }
            })
            .catch(error => console.error('Error fetching events data:', error));

        // Fetch publications data
        fetch('/user-metadata?category=publications')
            .then(response => response.json())
            .then(data => {
                // Populate the publications table with data
                const publicationsTableBody = document.querySelector('#publicationsTable tbody');
                publicationsTableBody.innerHTML = ''; // Clear any existing content

                if (data.length > 0) {
                    data.forEach(item => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${item.id}</td>
                            <td>${item.username}</td>
                            <td>${item.category}</td>
                            <td>${item.date}</td>
                            <td>${item.description}</td>
                            <td><a href="${item.misc}" target="_blank">Open Article</a></td>
                        `;
                        publicationsTableBody.appendChild(row);
                    });
                } else {
                    // If no data, show a message
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="6">No data available.</td>`;
                    publicationsTableBody.appendChild(row);
                }
            })
            .catch(error => console.error('Error fetching publications data:', error));
    });
</script>